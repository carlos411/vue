# 5.3 Events

## 元件綁定自訂事件並觸發

重點項目，元件內觸發一個自訂事件，然後父層的元件執行某函式：

* 使用 **`$emit`** 來觸發自訂事件。
* 使用 **`v-on`** 或 **`@`** 來定義自訂事件。
* 使用 **`.once`** 來讓事件僅會觸發一次。

範例：

在 `practice` 資料夾下，建立 `components/ButtonOnly.js` 檔案，內容如下：

```javascript
export default {
  emits: ["myEvent"],
  data(){
    return {};
  },
  // 按鈕點擊後，會觸發名稱為 myEvent 的事件
  template: `
    <div class="btn_block">
      <button type="button" @click="$emit('myEvent')">這是按鈕</button>
    </div>
  `
}
```

在 `practice` 資料夾下，建立 `component3_events.html`，內容如下：

```html
<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
    <div id="my_block">
      <!-- 使用了元件，且綁定了自訂事件 myEvent，一旦該事件觸發，會執行 test 函式 -->
      <button-only @my-event="test"></button-only>
      
      <!-- 又使用了元件，同上，但該事件只會觸發一次 -->
      <button-only @my-event.once="test"></button-only>
    </div>

    <script src="./vendors/vue/vue.global.js"></script>
    <!-- <script src="./vendors/vue/vue.global.prod.js"></script> -->
    
    <script type="module">
      import ButtonOnly from "./components/ButtonOnly.js"; // 載入元件

      const app = Vue.createApp({
        data(){
          return {};
        },
        methods: {
          test(){ // 定義了 test 函式
            alert("哈囉");
          }
        }
      });

      app.component("ButtonOnly", ButtonOnly); // 替 app 註冊了一個 ButtonOnly 元件

      app.mount("#my_block");
    </script>
  </body>
</html>
```

瀏覽 `http://127.0.0.1:3000/practice/component3_events.html` ，畫面如下(第一個按鈕可觸發事件多次，第二個按鈕僅會觸發一次)：

![](../.gitbook/assets/custom\_event1\_emit.png)

示意圖：

![](<../.gitbook/assets/component\_event\_hint (1).png>)

{% hint style="info" %}
emits 屬性是選用的，可以不用加，不過官方建議為了維持原始碼的閱讀性，建議加上。
{% endhint %}



## 事件參數

沿續上例，`ButtonOnly.js` 檔，將：

```html
<button type="button" @click="$emit('myEvent')">這是按鈕</button>
```

改成：

```html
<button type="button" @click="$emit('myEvent', 123)">這是按鈕</button>
```



`component3_events.html` 檔，將：

```javascript
test(){
  alert("哈囉");
}
```

改成：

```javascript
test(my_value){
  alert(my_value);
}
```

以上是以 1 個參數為例，若是 2 個參數、3 個參數等皆同理。



## 使用 v-model

先看這個例子：

{% embed url="https://codepen.io/carlos411/pen/jOYavOr" %}

可得知使用 `v-model`：

```html
<input type="text" v-model="searchText">
```

如果不用 v-model，改成自己寫的話，等同於以下：

```html
<input type="text" :value="searchText" @input="searchText = $event.target.value">
```



### 在自訂元件上使用 v-model

只要符合兩個條件：

* 將 value 綁定到 `modelValue`。
* 發送自訂事件 `update:modelValue` 即可。



建立 `components/CustomInput.js` 檔，內容如下：

```javascript
export default {
  props: ["modelValue"],
  emits: ["update:modelValue"],
  template: `
    <input type="text" :value="modelValue" @input="$emit('update:modelValue', $event.target.value)">
  `
}

```

在 `practice` 資料夾下，建立 `component4_v_model.html` 檔，內容如下：

```html
<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
    <div id="myapp">
      <custom-input v-model="searchText"></custom-input>

      <br>
      {{ searchText }}
    </div>

    <script src="./vendors/vue/vue.global.js"></script>
    <script type="module">
      import CustomInput from "./components/CustomInput.js";

      const app = Vue.createApp({
        data(){
          return {
            searchText: "hi"
          };
        }
      });

      app.component("CustomInput", CustomInput);
      app.mount("#myapp");
    </script>
  </body>
</html>

```



### 關於 v-model 參數

modelValue 和 update:modelValue 可以更改，假設想改成 `title` 和 `update:title`，那麼按照以下方式來更改。



沿續上例，將 `component4_v_model.html` 以下這行程式：

```html
<custom-input v-model="searchText"></custom-input>
```

改成：

```html
<custom-input v-model:title="searchText"></custom-input>
```



然後 `CustomInput.js` 改成如下：

```javascript
export default {
  props: ["title"],
  emits: ["update:title"],
  template: `
    <input type="text" :value="title" @input="$emit('update:title', $event.target.value)">
  `
}
```

即可完成。



### 在元件上使用多個 v-model

瞭解了上述的 **v-model 參數**之後，接下來可以用相同的觀念，來讓元件可以使用多次的 `v-model`，如下範例。



將 `v-model` 使用在 `firstName` 與 `lastName` 的範例，如下：

建立 `components/CustomInputMultiple.js` 檔案，內容如下：

```javascript
export default {
  props: ["firstName", "lastName"],
  emits: ["update:firstName", "update:lastName"],
  template: `
    <input type="text" :value="firstName" @input="$emit('update:firstName', $event.target.value)">
    <input type="text" :value="lastName" @input="$emit('update:lastName', $event.target.value)">
  `
}
```

在 `practice` 資料夾下，建立 `component5_v_model_multiple.html` 檔案，內容如下：

```html
<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
    <div id="myapp">
      <custom-input-multiple v-model:first-name="firstName" v-model:last-name="lastName"></custom-input-multiple>

      <br>
      {{ firstName }} {{ lastName }}
    </div>

    <script src="./vendors/vue/vue.global.js"></script>
    <script type="module">
      import CustomInputMultiple from "./components/CustomInputMultiple.js";

      const app = Vue.createApp({
        data(){
          return {
            firstName: "",
            lastName: ""
          };
        }
      });

      app.component("CustomInputMultiple", CustomInputMultiple);
      app.mount("#myapp");
    </script>
  </body>
</html>
```

即完成。



